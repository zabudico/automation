pipeline {
    agent {
        label 'php-agent'
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
                echo 'Automation repository cloned successfully'
            }
        }
        
        stage('Code Quality') {
            steps {
                echo 'Checking PHP syntax...'
                dir('lab04/php_arrays') {
                    sh '''
                        echo "Checking PHP files syntax..."
                        find . -name "*.php" -exec php -l {} \\;
                    '''
                }
            }
        }
        
        stage('Run Tests') {
            steps {
                echo 'Running PHP tests...'
                dir('lab04/php_arrays') {
                    sh 'php public/simple_tests.php'
                    sh 'php -l public/index.php'
                    sh 'php -l public/simple_tests.php'
                }
            }
        }
    }
    
    post {
        always {
            echo 'PHP Arrays Pipeline completed.'
        }
        success {
            echo ' All checks passed successfully!'
        }
        failure {
            echo ' Pipeline failed. Check the logs for errors.'
        }
    }
}